<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Details | Tappa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #050505;
            color: #fff;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .text-brand {
            color: #d16b07;
        }

        .bg-brand {
            background-color: #d16b07;
        }
    </style>
</head>

<body class="min-h-screen p-8">

    <!-- Header -->
    <div class="flex items-center justify-between mb-8 max-w-7xl mx-auto">
        <a href="hub.html" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            <span>Back to Hub</span>
        </a>
        <h1 class="text-2xl font-bold tracking-tight">MATCH CENTER</h1>
        <div class="w-20"></div>
    </div>

    <div id="loading" class="text-center mt-20 text-gray-500 animate-pulse">Loading Match Data...</div>

    <div id="match-content" class="hidden max-w-7xl mx-auto space-y-8">
        <!-- Scoreboard -->
        <div class="glass rounded-2xl p-8 flex items-center justify-between">
            <div class="text-center w-1/3">
                <h2 id="t1-name" class="text-3xl font-black uppercase tracking-tight mb-2">TEAM 1</h2>
                <div id="t1-stats" class="text-xs text-gray-500 font-mono space-x-2"></div>
            </div>
            <div class="text-center">
                <div class="text-6xl font-black font-mono tracking-tighter" id="score">0-0</div>
                <div class="text-brand font-bold uppercase tracking-widest text-xs mt-2">Final</div>
            </div>
            <div class="text-center w-1/3">
                <h2 id="t2-name" class="text-3xl font-black uppercase tracking-tight mb-2">TEAM 2</h2>
                <div id="t2-stats" class="text-xs text-gray-500 font-mono space-x-2"></div>
            </div>
        </div>

        <!-- Advanced Stats Grid -->
        <div class="grid grid-cols-4 gap-4">
            <div class="glass p-4 rounded-xl text-center">
                <div class="text-xs text-gray-500 uppercase">Pace</div>
                <div id="val-pace" class="text-2xl font-mono font-bold">0.0</div>
            </div>
            <div class="glass p-4 rounded-xl text-center">
                <div class="text-xs text-gray-500 uppercase">Possessions</div>
                <div id="val-poss" class="text-2xl font-mono font-bold text-gray-300">0.0</div>
            </div>
            <div class="glass p-4 rounded-xl text-center">
                <div class="text-xs text-gray-500 uppercase">Off Rtg (Home)</div>
                <div id="val-ortg1" class="text-2xl font-mono font-bold text-green-400">0.0</div>
            </div>
            <div class="glass p-4 rounded-xl text-center">
                <div class="text-xs text-gray-500 uppercase">Off Rtg (Away)</div>
                <div id="val-ortg2" class="text-2xl font-mono font-bold text-red-400">0.0</div>
            </div>
        </div>

        <!-- Box Score -->
        <div class="glass rounded-2xl p-6">
            <h3 class="text-lg font-bold mb-4 uppercase tracking-wider flex items-center gap-2">
                <span class="w-2 h-6 bg-brand block"></span>
                Box Score
            </h3>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse" id="box-table">
                    <!-- JS Injects -->
                </table>
            </div>
        </div>



    </div>

    <script src="static/js/data.js"></script>
    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        window.onload = function () {
            const matchId = getQueryParam('id');
            if (!matchId) {
                document.getElementById('loading').innerText = "No Match ID provided.";
                return;
            }

            // Find Match Meta
            const matchMeta = Object.values(TOURNAMENT_DATA.matches).find(m => m['Match ID'] == matchId);

            // Find Box Score Rows
            // NOTE: data.js 'box_scores' is the flat list of all player stats for all games.
            const boxStats = TOURNAMENT_DATA.box_scores.filter(s => s['Match ID'] == matchId);



            if (!matchMeta && boxStats.length === 0) {
                document.getElementById('loading').innerText = "Match Data Not Found.";
                return;
            }

            document.getElementById('loading').classList.add('hidden');
            document.getElementById('match-content').classList.remove('hidden');

            // Render Header
            if (matchMeta) {
                document.getElementById('t1-name').innerText = matchMeta.Team1;
                document.getElementById('t2-name').innerText = matchMeta.Team2;
                document.getElementById('score').innerText = matchMeta.Score;

                document.getElementById('val-pace').innerText = matchMeta.PACE;
                document.getElementById('val-poss').innerText = matchMeta.POSS;
                document.getElementById('val-ortg1').innerText = matchMeta.T1_OFFRTG;
                document.getElementById('val-ortg2').innerText = matchMeta.T2_OFFRTG;
            } else if (boxStats.length > 0) {
                // Fallback if no meta but we have stats
                const t1 = boxStats[0].Team;
                const t2 = boxStats.find(p => p.Team !== t1)?.Team || "Opponent";
                document.getElementById('t1-name').innerText = t1;
                document.getElementById('t2-name').innerText = t2;
            }

            // Render Box Table
            renderTable('box-table', boxStats, [
                { k: 'Player', l: 'Player', r: 0 },
                { k: 'Team', l: 'Team', r: 0 },
                { k: 'MIN', l: 'MIN', r: 1 },
                { k: 'PTS', l: 'PTS', r: 1, h: 1 },
                { k: 'REB', l: 'REB', r: 1 },
                { k: 'AST', l: 'AST', r: 1 },
                { k: 'STL', l: 'STL', r: 1 },
                { k: 'BLK', l: 'BLK', r: 1 },
                { k: 'TOV', l: 'TOV', r: 1 },
                { k: 'PF', l: 'PF', r: 1 },
                { k: 'TS%', l: 'TS%', r: 1 },
                { k: 'USG%', l: 'USG%', r: 1 }
            ]);


        };

        function renderTable(id, data, cols) {
            const t = document.getElementById(id);
            if (!data || data.length === 0) {
                t.innerHTML = `<tr><td class="p-4 text-gray-500 italic">No data available</td></tr>`;
                return;
            }

            // Sort by PTS or MIN (dumb default sort)
            // data.sort((a,b) => (b.PTS||0) - (a.PTS||0));

            let th = `<thead class="bg-black/40 text-xs uppercase text-gray-400 font-bold"><tr>`;
            cols.forEach(c => th += `<th class="p-3 ${c.r ? 'text-right' : ''}">${c.l}</th>`);
            th += `</tr></thead>`;

            let tb = `<tbody class="divide-y divide-white/5">`;
            data.forEach(row => {
                tb += `<tr class="hover:bg-white/5 transition-colors">`;
                cols.forEach(c => {
                    let v = row[c.k];
                    if (c.k === 'PlusMinus' && v > 0) v = `+${v}`;
                    let cls = c.r ? "text-right font-mono" : "";
                    if (c.h) cls += " text-brand font-bold";
                    if (c.k === 'PlusMinus') cls += (row[c.k] > 0 ? " text-green-400" : " text-red-400");
                    if (c.k === 'Team') cls += " text-xs uppercase tracking-wider text-gray-500";

                    tb += `<td class="p-3 ${cls}">${v !== undefined ? v : '-'}</td>`;
                });
                tb += `</tr>`;
            });
            tb += `</tbody>`;
            t.innerHTML = th + tb;
        }
    </script>
</body>

</html>